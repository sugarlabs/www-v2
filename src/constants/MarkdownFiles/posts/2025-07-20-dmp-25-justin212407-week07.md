---
title: "DMP’25 Week 07 Update by Justin Charles"
excerpt: "Implemented tower-level dragging in the workspace, enabling grouped brick movement and refining state synchronization across collisions"
category: "DEVELOPER NEWS"
date: "2025-07-20"
slug: "2025-07-20-dmp-25-justin212407-week07"
author: "@/constants/MarkdownFiles/authors/justin-charles.md"
tags: "dmp25,sugarlabs,week7,justin212407"
image: "assets/Images/c4gt_DMP.webp"
---

<!-- markdownlint-disable -->

# Week 7 Progress Report by Justin Charles

**Project:** Music Blocks 4 Masonry  
**Mentors:** [Anindya Kundu](https://github.com/meganindya/), [Sumit Srivastava](https://github.com/sum2it)  
**Assisting Mentors:** [Devin Ulibari](https://github.com/pikurasa/), [Walter Bender](https://github.com/walterbender)  
**Reporting Period:** 2025-07-12 - 2025-07-20   

---

## Goals for This Week

- Implement tower-level dragging for grouped bricks in the workspace  
- Ensure consistent updates to brick positions during drag  
- Synchronize tower state with collision maps in real-time  

---

## This Week’s Highlights

### 1. **Tower Dragging Implementation**

Worked on [PR #450](https://github.com/sugarlabs/musicblocks-v4/pull/450) to add tower-level dragging:
- Enabled movement of entire towers (root brick + children) as a single unit  
- Preserved parent-child hierarchy when updating positions  
- Improved drag responsiveness by recalculating bounding boxes during movement  

### 2. **State Synchronization Across Towers**

- Updated `TowerModel` to handle bulk position updates for all bricks within a tower  
- Integrated with collision maps so towers temporarily unregister during drag and re-register on drop  
- Enhanced React state management for smoother rendering of large tower movements  

### 3. **User Interaction Improvements**

- Introduced proper offset handling to keep drag anchor consistent regardless of tower size  
- Added visual feedback for tower movement, ensuring alignment with cursor  
- Prepared groundwork for snapping logic to align towers when dropped near others  

---

## Challenges & Solutions

**Challenge:** Dragging large towers caused lag due to repeated state updates  
**Solution:** Batched updates at the tower level and minimized per-brick re-renders  

**Challenge:** Maintaining relative brick positions while dragging  
**Solution:** Used stored subtree offsets to apply uniform translation during movement  

---

## Key Learnings

- **Tower-Level Abstractions**  
  Learned how to extend single-brick drag logic to tower hierarchies without breaking child alignment  

- **Batching Updates**  
  Saw the importance of batching atom updates in Recoil to avoid UI jank in React  

- **Collision Integration**  
  Understood how temporary removal from collision maps avoids false positives during active drag  

---

## Next Week’s Roadmap

- Implement snapping between towers using collision hints  
- Add shadow previews during drag for better visual guidance  
- Begin refining detach/attach logic for bricks when splitting or merging towers  

---

## Resources & References

- [musicblocks-v4 PR #450](https://github.com/sugarlabs/musicblocks-v4/pull/450)  
- [musicblocks-v4 Repository](https://github.com/sugarlabs/musicblocks-v4)  
---

## Acknowledgments

Thanks to my mentors for guiding me through scaling drag logic from bricks to full towers.
